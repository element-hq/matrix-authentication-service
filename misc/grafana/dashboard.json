{
   "description": "A dashboard for monitoring matrix-authentication-service",
   "graphTooltip": 1,
   "panels": [
      {
         "collapsed": false,
         "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 0
         },
         "id": 1,
         "panels": [ ],
         "title": "Deployment",
         "type": "row"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "drawStyle": "line",
                  "fillOpacity": 100,
                  "lineWidth": 0,
                  "stacking": {
                     "mode": "percent"
                  }
               }
            }
         },
         "gridPos": {
            "h": 6,
            "w": 24,
            "x": 0,
            "y": 1
         },
         "id": 2,
         "options": {
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (service_version) (target_info{job=~\"$job\", instance=~\"$instance\"})",
               "legendFormat": "{{service_version}}"
            }
         ],
         "title": "Service Version",
         "type": "timeseries"
      },
      {
         "collapsed": true,
         "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 100
         },
         "id": 3,
         "panels": [
            {
               "datasource": {
                  "type": "datasource",
                  "uid": "-- Mixed --"
               },
               "gridPos": {
                  "h": 6,
                  "w": 8,
                  "x": 0,
                  "y": 0
               },
               "id": 4,
               "pluginVersion": "v11.4.0",
               "targets": [
                  {
                     "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                     },
                     "expr": "sum(tokio_runtime_workers{job=~\"$job\", instance=~\"$instance\"})"
                  }
               ],
               "title": "Workers",
               "type": "stat"
            },
            {
               "datasource": {
                  "type": "datasource",
                  "uid": "-- Mixed --"
               },
               "gridPos": {
                  "h": 6,
                  "w": 8,
                  "x": 8,
                  "y": 0
               },
               "id": 5,
               "options": {
                  "calculate": false,
                  "cellGap": 0,
                  "yAxis": {
                     "unit": "ns"
                  }
               },
               "pluginVersion": "v11.4.0",
               "targets": [
                  {
                     "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                     },
                     "expr": "sum by (le) (irate(tokio_runtime_worker_poll_time_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]))",
                     "format": "heatmap"
                  }
               ],
               "title": "Tick Time",
               "type": "heatmap"
            },
            {
               "datasource": {
                  "type": "datasource",
                  "uid": "-- Mixed --"
               },
               "fieldConfig": {
                  "defaults": {
                     "custom": {
                        "fillOpacity": 10
                     },
                     "min": 0,
                     "unit": "ns"
                  }
               },
               "gridPos": {
                  "h": 6,
                  "w": 8,
                  "x": 16,
                  "y": 0
               },
               "id": 6,
               "options": {
                  "legend": {
                     "calcs": [
                        "mean"
                     ]
                  },
                  "tooltip": {
                     "mode": "multi",
                     "sort": "desc"
                  }
               },
               "pluginVersion": "v11.4.0",
               "targets": [
                  {
                     "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                     },
                     "expr": "histogram_quantile(0.99, sum by (le) (irate(tokio_runtime_worker_poll_time_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])))",
                     "legendFormat": "P99",
                     "refId": "P99"
                  },
                  {
                     "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                     },
                     "expr": "histogram_quantile(0.95, sum by (le) (irate(tokio_runtime_worker_poll_time_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])))",
                     "legendFormat": "P95",
                     "refId": "P95"
                  },
                  {
                     "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                     },
                     "expr": "histogram_quantile(0.90, sum by (le) (irate(tokio_runtime_worker_poll_time_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])))",
                     "legendFormat": "P90",
                     "refId": "P90"
                  },
                  {
                     "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                     },
                     "expr": "histogram_quantile(0.50, sum by (le) (irate(tokio_runtime_worker_poll_time_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])))",
                     "legendFormat": "P50",
                     "refId": "P50"
                  }
               ],
               "title": "Tick Time Percentile",
               "type": "timeseries"
            },
            {
               "datasource": {
                  "type": "datasource",
                  "uid": "-- Mixed --"
               },
               "fieldConfig": {
                  "defaults": {
                     "min": 0,
                     "unit": "ops"
                  }
               },
               "gridPos": {
                  "h": 6,
                  "w": 8,
                  "x": 0,
                  "y": 0
               },
               "id": 7,
               "pluginVersion": "v11.4.0",
               "targets": [
                  {
                     "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                     },
                     "expr": "sum(irate(tokio_runtime_worker_polls_total{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]))",
                     "legendFormat": "Polls"
                  }
               ],
               "title": "Poll Rate",
               "type": "timeseries"
            },
            {
               "datasource": {
                  "type": "datasource",
                  "uid": "-- Mixed --"
               },
               "fieldConfig": {
                  "defaults": {
                     "min": 0,
                     "unit": "tasks"
                  }
               },
               "gridPos": {
                  "h": 6,
                  "w": 8,
                  "x": 8,
                  "y": 0
               },
               "id": 8,
               "pluginVersion": "v11.4.0",
               "targets": [
                  {
                     "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                     },
                     "expr": "sum(tokio_runtime_alive_tasks{job=~\"$job\", instance=~\"$instance\"})",
                     "legendFormat": "Active Tasks"
                  }
               ],
               "title": "Active Tasks",
               "type": "timeseries"
            },
            {
               "datasource": {
                  "type": "datasource",
                  "uid": "-- Mixed --"
               },
               "fieldConfig": {
                  "defaults": {
                     "min": 0,
                     "unit": "ms"
                  }
               },
               "gridPos": {
                  "h": 6,
                  "w": 8,
                  "x": 16,
                  "y": 0
               },
               "id": 9,
               "pluginVersion": "v11.4.0",
               "targets": [
                  {
                     "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                     },
                     "expr": "sum(irate(tokio_runtime_worker_busy_duration_milliseconds_total{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]))",
                     "legendFormat": "Worker busy Time"
                  }
               ],
               "title": "Busy Time",
               "type": "timeseries"
            }
         ],
         "title": "Tokio",
         "type": "row"
      },
      {
         "collapsed": false,
         "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 200
         },
         "id": 10,
         "panels": [ ],
         "title": "HTTP server",
         "type": "row"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "min": 0,
               "unit": "reqps"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 201
         },
         "id": 11,
         "options": {
            "legend": {
               "calcs": [
                  "mean"
               ],
               "displayMode": "table",
               "placement": "right"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (http_request_method, http_route, http_response_status_code )\n(irate(http_server_duration_count{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]))\n",
               "legendFormat": "{{http_request_method}} {{http_route}} {{http_response_status_code}}"
            }
         ],
         "title": "Requests",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "min": 0,
               "unit": "reqps"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 201
         },
         "id": 12,
         "options": {
            "legend": {
               "calcs": [
                  "mean"
               ],
               "displayMode": "table",
               "placement": "right"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (http_request_method, http_route, http_response_status_code)\n(irate(http_server_duration_count{job=~\"$job\", instance=~\"$instance\", http_response_status_code=~\"4..|5..\"}[$__rate_interval]))\n",
               "legendFormat": "{{http_request_method}} {{http_route}} {{http_response_status_code}}"
            }
         ],
         "title": "Errors",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 209
         },
         "id": 13,
         "options": {
            "calculate": false,
            "cellGap": 0,
            "yAxis": {
               "unit": "ms"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (le) (\n  irate(http_server_duration_bucket{job=~\"$job\", instance=~\"$instance\", http_route!=\"/oauth2/introspect\"}[$__rate_interval])\n)\n",
               "format": "heatmap"
            }
         ],
         "title": "Request latency (excluding introspection)",
         "type": "heatmap"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10
               },
               "min": 0,
               "unit": "ms"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 209
         },
         "id": 14,
         "options": {
            "legend": {
               "calcs": [
                  "mean"
               ]
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.99, sum by (le) (\n  irate(http_server_duration_bucket{job=~\"$job\", instance=~\"$instance\", http_route!=\"/oauth2/introspect\"}[$__rate_interval])\n))\n",
               "legendFormat": "P99",
               "refId": "P99"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.95, sum by (le) (\n  irate(http_server_duration_bucket{job=~\"$job\", instance=~\"$instance\", http_route!=\"/oauth2/introspect\"}[$__rate_interval])\n))\n",
               "legendFormat": "P95",
               "refId": "P95"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.90, sum by (le) (\n  irate(http_server_duration_bucket{job=~\"$job\", instance=~\"$instance\", http_route!=\"/oauth2/introspect\"}[$__rate_interval])\n))\n",
               "legendFormat": "P90",
               "refId": "P90"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.50, sum by (le) (\n  irate(http_server_duration_bucket{job=~\"$job\", instance=~\"$instance\", http_route!=\"/oauth2/introspect\"}[$__rate_interval])\n))\n",
               "legendFormat": "P50",
               "refId": "P50"
            }
         ],
         "title": "Request latency percentiles (excluding introspection)",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 217
         },
         "id": 15,
         "options": {
            "calculate": false,
            "cellGap": 0,
            "yAxis": {
               "unit": "ms"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (le) (\n  irate(http_server_duration_bucket{job=~\"$job\", instance=~\"$instance\", http_route=\"/oauth2/introspect\"}[$__rate_interval])\n)\n",
               "format": "heatmap"
            }
         ],
         "title": "Request latency (introspection only)",
         "type": "heatmap"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10
               },
               "min": 0,
               "unit": "ms"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 217
         },
         "id": 16,
         "options": {
            "legend": {
               "calcs": [
                  "mean"
               ]
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.99, sum by (le) (\n  irate(http_server_duration_bucket{job=~\"$job\", instance=~\"$instance\", http_route=\"/oauth2/introspect\"}[$__rate_interval])\n))\n",
               "legendFormat": "P99",
               "refId": "P99"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.95, sum by (le) (\n  irate(http_server_duration_bucket{job=~\"$job\", instance=~\"$instance\", http_route=\"/oauth2/introspect\"}[$__rate_interval])\n))\n",
               "legendFormat": "P95",
               "refId": "P95"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.90, sum by (le) (\n  irate(http_server_duration_bucket{job=~\"$job\", instance=~\"$instance\", http_route=\"/oauth2/introspect\"}[$__rate_interval])\n))\n",
               "legendFormat": "P90",
               "refId": "P90"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.50, sum by (le) (\n  irate(http_server_duration_bucket{job=~\"$job\", instance=~\"$instance\", http_route=\"/oauth2/introspect\"}[$__rate_interval])\n))\n",
               "legendFormat": "P50",
               "refId": "P50"
            }
         ],
         "title": "Request latency percentiles (introspection only)",
         "type": "timeseries"
      },
      {
         "collapsed": false,
         "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 300
         },
         "id": 17,
         "panels": [ ],
         "title": "Database",
         "type": "row"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "gridPos": {
            "h": 8,
            "w": 8,
            "x": 0,
            "y": 301
         },
         "id": 18,
         "options": {
            "calculate": false,
            "cellGap": 0,
            "yAxis": {
               "unit": "ms"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (le) (\n  irate(db_client_connections_create_time_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n)\n",
               "format": "heatmap"
            }
         ],
         "title": "Database connection acquisition latency",
         "type": "heatmap"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10
               },
               "min": 0,
               "unit": "ms"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 8,
            "x": 8,
            "y": 301
         },
         "id": 19,
         "options": {
            "legend": {
               "calcs": [
                  "mean"
               ]
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.99, sum by (le) (\n  irate(db_client_connections_create_time_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P99"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.95, sum by (le) (\n  irate(db_client_connections_create_time_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P95"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.90, sum by (le) (\n  irate(db_client_connections_create_time_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P90"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.50, sum by (le) (\n  irate(db_client_connections_create_time_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P50"
            }
         ],
         "title": "Database connection acquisition latency percentiles",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "drawStyle": "line",
                  "fillOpacity": 100,
                  "lineWidth": 0,
                  "stacking": {
                     "mode": "normal"
                  }
               },
               "min": 0
            }
         },
         "gridPos": {
            "h": 8,
            "w": 8,
            "x": 16,
            "y": 301
         },
         "id": 20,
         "options": {
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (state) (db_connections_usage{job=~\"$job\", instance=~\"$instance\"})\n",
               "legendFormat": "Connection {{state}}"
            }
         ],
         "title": "Database connection pool usage",
         "type": "timeseries"
      },
      {
         "collapsed": false,
         "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 400
         },
         "id": 21,
         "panels": [ ],
         "title": "Jobs",
         "type": "row"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "gridPos": {
            "h": 8,
            "w": 8,
            "x": 0,
            "y": 401
         },
         "id": 22,
         "options": {
            "calculate": false,
            "cellGap": 0,
            "yAxis": {
               "unit": "ms"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (le) (\n  irate(job_process_duration_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n)\n",
               "format": "heatmap"
            }
         ],
         "title": "Job run duration",
         "type": "heatmap"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "min": 0,
               "unit": "ms"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 8,
            "x": 8,
            "y": 401
         },
         "id": 23,
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.95, sum by (le, job_queue_name) (\n  irate(job_process_duration_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "{{job_queue_name}}",
               "refId": "P95"
            }
         ],
         "title": "Job run P95 per type",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "min": 0,
               "unit": "ops"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 8,
            "x": 16,
            "y": 401
         },
         "id": 24,
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by(job_queue_name, job_result)\n(irate(job_process_duration_milliseconds_count{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval]))\n",
               "legendFormat": "{{job_queue_name}} {{job_result}}"
            }
         ],
         "title": "Job runs",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "gridPos": {
            "h": 8,
            "w": 8,
            "x": 0,
            "y": 409
         },
         "id": 25,
         "options": {
            "calculate": false,
            "cellGap": 0,
            "yAxis": {
               "unit": "ms"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (le) (\n  irate(job_worker_tick_duration_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n)\n",
               "format": "heatmap"
            }
         ],
         "title": "Worker tick duration",
         "type": "heatmap"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10
               },
               "min": 0,
               "unit": "ms"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 8,
            "x": 8,
            "y": 409
         },
         "id": 26,
         "options": {
            "legend": {
               "calcs": [
                  "mean"
               ]
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.99, sum by (le) (\n  irate(job_worker_tick_duration_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P99",
               "refId": "P99"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.95, sum by (le) (\n  irate(job_worker_tick_duration_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P95",
               "refId": "P95"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.90, sum by (le) (\n  irate(job_worker_tick_duration_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P90",
               "refId": "P90"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.50, sum by (le) (\n  irate(job_worker_tick_duration_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P50",
               "refId": "P50"
            }
         ],
         "title": "Worker tick duration percentiles",
         "type": "timeseries"
      },
      {
         "collapsed": false,
         "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 500
         },
         "id": 27,
         "panels": [ ],
         "title": "Activity tracker",
         "type": "row"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "min": 0,
               "unit": "ops"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 8,
            "x": 0,
            "y": 501
         },
         "id": 28,
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by(session_kind)\n(irate(mas_activity_tracker_messages_total{job=~\"$job\", instance=~\"$instance\", type=\"record\"}[$__rate_interval]))\n",
               "legendFormat": "{{session_kind}}"
            }
         ],
         "title": "Record rate",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "gridPos": {
            "h": 8,
            "w": 8,
            "x": 8,
            "y": 501
         },
         "id": 29,
         "options": {
            "calculate": false,
            "cellGap": 0,
            "yAxis": {
               "unit": "ms"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (le) (\n  irate(mas_activity_tracker_flush_time_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n)\n",
               "format": "heatmap"
            }
         ],
         "title": "Flush time",
         "type": "heatmap"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10
               },
               "min": 0,
               "unit": "ms"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 8,
            "x": 16,
            "y": 501
         },
         "id": 30,
         "options": {
            "legend": {
               "calcs": [
                  "mean"
               ]
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.99, sum by (le) (\n  irate(mas_activity_tracker_flush_time_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P99",
               "refId": "P99"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.95, sum by (le) (\n  irate(mas_activity_tracker_flush_time_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P95",
               "refId": "P95"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.90, sum by (le) (\n  irate(mas_activity_tracker_flush_time_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P90",
               "refId": "P90"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "histogram_quantile(0.50, sum by (le) (\n  irate(mas_activity_tracker_flush_time_milliseconds_bucket{job=~\"$job\", instance=~\"$instance\"}[$__rate_interval])\n))\n",
               "legendFormat": "P50",
               "refId": "P50"
            }
         ],
         "title": "Flush time percentiles",
         "type": "timeseries"
      }
   ],
   "schemaVersion": 39,
   "templating": {
      "list": [
         {
            "includeAll": false,
            "multi": false,
            "name": "datasource",
            "query": "prometheus",
            "refresh": 1,
            "type": "datasource"
         },
         {
            "datasource": {
               "type": "prometheus",
               "uid": "${datasource}"
            },
            "includeAll": true,
            "multi": false,
            "name": "job",
            "query": "label_values(target_info, job)",
            "refresh": 1,
            "type": "query"
         },
         {
            "allValue": ".*",
            "datasource": {
               "type": "prometheus",
               "uid": "${datasource}"
            },
            "includeAll": true,
            "multi": false,
            "name": "instance",
            "query": "label_values(target_info{job=~\"$job\"}, instance)",
            "refresh": 2,
            "type": "query"
         }
      ]
   },
   "time": {
      "from": "now-6h",
      "to": "now"
   },
   "timezone": "utc",
   "title": "matrix-authentication-service",
   "uid": "matrix-authentication-service"
}
