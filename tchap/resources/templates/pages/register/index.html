{#
Copyright 2024, 2025 New Vector Ltd.
Copyright 2021-2024 The Matrix.org Foundation C.I.C.

SPDX-License-Identifier: AGPL-3.0-only OR LicenseRef-Element-Commercial
Please see LICENSE files in the repository root for full details.
-#}

{% extends "base.html" %}

{% from "components/idp_brand.html" import logo %}

{% block content %}
    <header class="page-heading">
      <div class="icon">
        {{ icon.user_profile_solid() }}
      </div>

      <div class="header">
        <h1 class="title">{{ _("action.create_account") }}</h1>
        <!-- :tchap: -->
        {% if features.password_registration and False  %}
        <!-- :tchap: -->
          <p class="text">{{ _("mas.register.create_account.description") }}</p>
        {% endif %}
      </div>
    </header>

    <!-- #tchap# -->
    {% set params = next["params"] | default({}) | to_params(prefix="?") %}
    {% for provider in providers %}
    {% set name = provider.human_name or (provider.issuer | simplify_url(keep_path=True)) or provider.id %}

    <!-- #tchap# add .lasuite class to add lasuite fonts -->
    <div class="cpd-form-root lasuite">
        <button class="proconnect-button" onclick="window.location.href = '{{ ('/upstream/authorize/' ~ provider.id ~ params) | prefix_url }}';">
          <span class="proconnect-sr-only">S'identifier avec ProConnect</span>
        </button>
        <p>
          <a
          href="https://www.proconnect.gouv.fr/"
          target="_blank"
          rel="noopener noreferrer"
          title="Qu’est-ce que ProConnect ? - nouvelle fenêtre"
          class="cpd-text-secondary"
          >
          Qu’est-ce que ProConnect ?
        </a>
      </p>
    </div>
    {% endfor %}

    {{ field.separator() }}

    <form method="GET" class="flex flex-col gap-10" action="{{ '/register/password' | prefix_url }}">
    <!-- :tchap: -->
    {% if features.password_registration and False %}
    <!-- :tchap: -->
      {% call(f) field.field(label=_("common.username"), name="username", form_state=form) %}
        <input {{ field.attributes(f) }} class="cpd-text-control" type="text" autocomplete="username" autocorrect="off" autocapitalize="off" />
        <div class="cpd-form-message cpd-form-help-message" id="{{ f.id }}-help">
          @username:{{ branding.server_name }}
        </div>
      {% endcall %}
    {% endif %}

    <div class="cpd-form-root">
      {% for key, value in next["params"] | default({}) | items %}
        <input type="hidden" name="{{ key }}" value="{{ value }}" />
      {% endfor %}

      {% if features.password_registration %}
        {{ button.button(text=_("mas.register.continue_with_email"), kind="secondary") }}
      {% endif %}
        <!-- :tchap: no providers
              {% if providers %}
                {% set params = next["params"] | default({}) | to_params(prefix="?") %}
                {% for provider in providers %}
                  {% set name = provider.human_name or (provider.issuer | simplify_url(keep_path=True)) or provider.id %}
                  <a class="cpd-button {%- if provider.brand_name %} has-icon {%- endif %}" data-kind="secondary" data-size="lg" href="{{ ('/upstream/authorize/' ~ provider.id ~ params) | prefix_url }}">
                    {{ logo(provider.brand_name) }}
                    {{ _("mas.login.continue_with_provider", provider=name) }}
                  </a>
                {% endfor %}
              {% endif %}
        :tchap: end -->
        
      {% set params = next["params"] | default({}) | to_params(prefix="?") %}
      {{ button.link_tertiary(text=_("mas.register.call_to_login"), href="/login" ~ params) }}
    </div>
  </form>
{% endblock content %}
